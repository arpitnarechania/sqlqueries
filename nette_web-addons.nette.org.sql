CREATE TABLE `pages` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(100) NOT NULL COMMENT 'page title', `slug` varchar(100) NOT NULL, `revision` int(5) NOT NULL COMMENT 'revision number', `authorId` int(10) unsigned NOT NULL COMMENT 'revision author', `content` text NOT NULL, `createdAt` datetime NOT NULL COMMENT 'revision created at', PRIMARY KEY (`id`), UNIQUE KEY `slug_revision` (`slug`,`revision`), KEY `authorId` (`authorId`), CONSTRAINT `pages_ibfk_1` FOREIGN KEY (`authorId`) REFERENCES `users` (`id`))
CREATE TABLE `addons_votes` ( `addonId` int(10) unsigned NOT NULL, `userId` int(10) unsigned NOT NULL, `vote` tinyint(4) NOT NULL COMMENT '+1 / -1', `comment` varchar(1000) DEFAULT NULL, `datetime` datetime NOT NULL, PRIMARY KEY (`addonId`,`userId`), KEY `userId` (`userId`), CONSTRAINT `addons_votes_ibfk_2` FOREIGN KEY (`userId`) REFERENCES `users` (`id`), CONSTRAINT `addons_votes_ibfk_3` FOREIGN KEY (`addonId`) REFERENCES `addons` (`id`) ON DELETE CASCADE ON UPDATE CASCADE)
CREATE TABLE `addons_dependencies` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT, `versionId` int(10) unsigned NOT NULL, `dependencyId` int(10) unsigned DEFAULT NULL, `packageName` varchar(100) NOT NULL, `version` varchar(20) NOT NULL, `type` enum('require','require-dev','suggest','provide','replace','conflict','recommend') NOT NULL DEFAULT 'require', PRIMARY KEY (`id`), UNIQUE KEY `versionId_type_packageName` (`versionId`,`type`,`packageName`), KEY `dependencyId` (`dependencyId`), CONSTRAINT `addons_dependencies_ibfk_4` FOREIGN KEY (`versionId`) REFERENCES `addons_versions` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, CONSTRAINT `addons_dependencies_ibfk_5` FOREIGN KEY (`dependencyId`) REFERENCES `addons` (`id`) ON DELETE CASCADE)
CREATE TABLE `users_groups` ( `g_id` int(10) unsigned NOT NULL AUTO_INCREMENT, `g_title` varchar(50) NOT NULL DEFAULT '', `g_user_title` varchar(50) DEFAULT NULL, `g_read_board` tinyint(1) NOT NULL DEFAULT '1', `g_post_replies` tinyint(1) NOT NULL DEFAULT '1', `g_post_topics` tinyint(1) NOT NULL DEFAULT '1', `g_post_polls` tinyint(1) NOT NULL DEFAULT '1', `g_edit_posts` tinyint(1) NOT NULL DEFAULT '1', `g_delete_posts` tinyint(1) NOT NULL DEFAULT '1', `g_delete_topics` tinyint(1) NOT NULL DEFAULT '1', `g_set_title` tinyint(1) NOT NULL DEFAULT '1', `g_search` tinyint(1) NOT NULL DEFAULT '1', `g_search_users` tinyint(1) NOT NULL DEFAULT '1', `g_edit_subjects_interval` smallint(6) NOT NULL DEFAULT '300', `g_post_flood` smallint(6) NOT NULL DEFAULT '30', `g_search_flood` smallint(6) NOT NULL DEFAULT '30', PRIMARY KEY (`g_id`))
CREATE TABLE `tags` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT, `name` varchar(50) NOT NULL COMMENT 'user friendly form', `slug` varchar(50) NOT NULL, `level` smallint(5) unsigned NOT NULL COMMENT '1 = category, 2 = subcategory, 9 = others', `parent_id` int(10) unsigned NOT NULL DEFAULT '0', `visible` tinyint(1) unsigned NOT NULL DEFAULT '1' COMMENT 'visible on homepage', PRIMARY KEY (`id`), UNIQUE KEY `slug` (`slug`))
CREATE TABLE `addons_tags` ( `addonId` int(10) unsigned NOT NULL, `tagId` int(10) unsigned NOT NULL, PRIMARY KEY (`addonId`,`tagId`), KEY `tagid` (`tagId`), CONSTRAINT `addons_tags_ibfk_3` FOREIGN KEY (`addonId`) REFERENCES `addons` (`id`) ON DELETE CASCADE ON UPDATE CASCADE, CONSTRAINT `addons_tags_ibfk_4` FOREIGN KEY (`tagId`) REFERENCES `tags` (`id`) ON DELETE CASCADE ON UPDATE CASCADE)
CREATE TABLE `cron` ( `id` int(11) unsigned NOT NULL AUTO_INCREMENT, `server` varchar(128) NOT NULL, `name` varchar(128) NOT NULL, `start` datetime NOT NULL, `stop` datetime DEFAULT NULL, `time` int(10) unsigned DEFAULT NULL, `memory` float unsigned DEFAULT NULL, `result` varchar(32) DEFAULT NULL, PRIMARY KEY (`id`))
CREATE TABLE `addons_resources` ( `id` int(11) NOT NULL AUTO_INCREMENT, `addonId` int(10) unsigned NOT NULL, `type` varchar(32) NOT NULL, `resource` varchar(256) NOT NULL, PRIMARY KEY (`id`), KEY `addonId` (`addonId`), KEY `type` (`type`), CONSTRAINT `addons_resources_ibfk_1` FOREIGN KEY (`addonId`) REFERENCES `addons` (`id`) ON DELETE CASCADE)
CREATE TABLE `addons_downloads` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT, `versionId` int(10) unsigned NOT NULL, `userId` int(10) unsigned DEFAULT NULL, `ipAddress` varchar(39) NOT NULL COMMENT 'ipv6 has <=39 characters', `userAgent` varchar(255) DEFAULT NULL, `time` datetime NOT NULL, `type` enum('download','install') NOT NULL COMMENT 'download via web / install via composer', `fake` tinyint(1) unsigned NOT NULL DEFAULT '0', PRIMARY KEY (`id`), KEY `versionId` (`versionId`), KEY `userId` (`userId`), CONSTRAINT `addons_downloads_ibfk_3` FOREIGN KEY (`userId`) REFERENCES `users` (`id`), CONSTRAINT `addons_downloads_ibfk_4` FOREIGN KEY (`versionId`) REFERENCES `addons_versions` (`id`) ON DELETE CASCADE)
CREATE TABLE `addons_reports` ( `id` int(11) NOT NULL AUTO_INCREMENT, `userId` int(10) unsigned NOT NULL COMMENT 'who reported', `addonId` int(10) unsigned NOT NULL COMMENT 'concerned addon', `reportedAt` datetime NOT NULL COMMENT 'repored at this datetime', `message` text NOT NULL COMMENT 'why is reported', `reason` text COMMENT 'solution description', `zappedBy` int(10) unsigned DEFAULT NULL COMMENT 'who zapped', PRIMARY KEY (`id`), KEY `userId` (`userId`), KEY `addonId` (`addonId`), KEY `zappedBy` (`zappedBy`), CONSTRAINT `addons_reports_ibfk_1` FOREIGN KEY (`userId`) REFERENCES `users` (`id`), CONSTRAINT `addons_reports_ibfk_2` FOREIGN KEY (`addonId`) REFERENCES `addons` (`id`), CONSTRAINT `addons_reports_ibfk_3` FOREIGN KEY (`zappedBy`) REFERENCES `users` (`id`))
